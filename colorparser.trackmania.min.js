var COLORPARSER=function(){function c(a){var b=/^(https?|ftp):\/\/([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/;return b.test(a)}function d(a){return!c(a)&&c("http://"+a)?"http://"+a:a}function e(a,b=true){a=f(a),a=a.replace("$L","$l"),chunks=a.split("$l");for(var c=!1,e=1;e<chunks.length;e++){var g=/^\[(.*)\](.*)/,h=g.exec(chunks[e]);h?(chunks[e]='<a href="'+d(h[1])+'">'+h[2]+"</a>",c=!0):c?c=!1:(chunks[e]='<a href="'+d(chunks[e])+'">'+chunks[e].replace("http://","").replace("https://","")+"</a>",c=!0)}return chunks.join("")}function f(c,d=true){c=c.replace("$H","$h"),chunks=c.split("$h");for(var e=!1,f=1;f<chunks.length;f++){var g=/^\[(.*)\](.*)/,h=g.exec(chunks[f]);if(h){switch(b.game){case"TMF":chunks[f]='<a href="'+a.MANIALINK_PREFIX_TMF+h[1]+'">'+h[2]+"</a>";break;case"MP":chunks[f]='<a href="'+a.MANIALINK_PREFIX_MP+h[1]+'">'+h[2]+"</a>"}e=!0}else if(e)e=!1;else{switch(b.game){case"TMF":chunks[f]='<a href="'+a.MANIALINK_PREFIX_TMF+chunks[f]+'">'+chunks[f]+"</a>";break;case"MP":chunks[f]='<a href="'+a.MANIALINK_PREFIX_MP+chunks[f]+'">'+chunks[f]+"</a>"}e=!0}}return chunks.join("")}var a={HTML_DOLLAR:"&#36;",HTML_WHITESPACE:"&nbsp;",HTML_STYLE_ITALIC:"font-style:italic;",HTML_STYLE_BOLD:"font-weight:bold;",HTML_STYLE_NARROW:"letter-spacing:-0.1em;font-size:smaller",MANIALINK_PREFIX_TMF:"tmtp:///:",MANIALINK_PREFIX_MP:"maniaplanet:///:",SHADOWING_STYLE:"text-shadow: 1px 1px 1px #000; letter-spacing: 1px;",SHADOWING_CLASS:!1},b={};return b.game="TMF",b.shadowing=!1,b.setGame=function(a){return"TMF"==a?(b.game="TMF",!0):("TM2"==a||"MP"==a)&&(b.game="MP",!0)},b.setShadowing=function(a){a?b.shadowing=!0:b.shadowing=!1},b.getStyledString=function(b,c,d,e,f,g,h,i){if(b=b.substring(c.length),g&&(b=b.toUpperCase()),(d||e||f||h)&&b.length>0){var j="";d&&!i&&(j+="color:#"+d+";"),h&&(j+=a.HTML_STYLE_ITALIC),e&&(j+=a.HTML_STYLE_BOLD),f&&(j+=a.HTML_STYLE_NARROW),b='<span style="'+j+'">'+b+"</span>"}return b},b.toHTML=function(c,d=false,f=true,g="",h=true){var i=!1,j=!1,k=!1,l=!1,m=!1,n={color:!1,wide:!1,narrow:!1,caps:!1,italic:!1};"all"==g.toLowerCase()&&(g="iwonstmgaxz");for(var o=0;o<g.length;o++)c=c.replace("$"+g[o],"");c=c.replace("$$",a.HTML_DOLLAR),c=c.replace(" ",a.HTML_WHITESPACE),c=e(c,!f);for(var p=c.split("$"),o=1;o<p.length;o++){manialinks=[];var q=p[o].match(/^[0-9a-f]{2,3}/i);q?(i=q[0],i.length<3&&(i+=8),i=i[0]+i[0]+i[1]+i[1]+i[2]+i[2],p[o]=b.getStyledString(p[o],q[0],i,j,k,l,m,d)):(q=p[o].match(/^(i)/i),q?(m=!0,p[o]=b.getStyledString(p[o],q[0],i,j,k,l,m,d)):(q=p[o].match(/^(w)/i),q?(k=!1,j=!0,p[o]=b.getStyledString(p[o],q[0],i,j,k,l,m,d)):(q=p[o].match(/^(o)/i),q?(k=!1,j=!0,p[o]=b.getStyledString(p[o],q[0],i,j,k,l,m,d)):(q=p[o].match(/^(n)/i),q?(k=!0,j=!1,p[o]=b.getStyledString(p[o],q[0],i,j,k,l,m,d)):(q=p[o].match(/^(s)/i),q?p[o]=b.getStyledString(p[o],q[0],i,j,k,l,m,d):(q=p[o].match(/^(t)/i),q?(l=!0,p[o]=b.getStyledString(p[o],q[0],i,j,k,l,m,d)):(q=p[o].match(/^(m)/i),q?(j=!1,bold=!1,p[o]=b.getStyledString(p[o],q[0],i,j,k,l,m,d)):(q=p[o].match(/^(g)/i),q?(i=!1,p[o]=b.getStyledString(p[o],q[0],i,j,k,l,m,d)):(q=p[o].match(/^(g)/i),q?(n.color=i,n.wide=j,n.narrow=k,n.caps=l,n.italic=m,i=!1,j=!1,k=!1,l=!1,m=!1,p[o]=b.getStyledString(p[o],q[0],i,j,k,l,m,d)):(q=p[o].match(/^(x)/i),q?(i=n.color,j=n.wide,k=n.narrow,l=n.caps,m=n.italic,p[o]=b.getStyledString(p[o],q[0],i,j,k,l,m,d)):(q=p[o].match(/^(z)/i),q&&(i=!1,j=!1,k=!1,l=!1,m=!1,p[o]=b.getStyledString(p[o],q[0],i,j,k,l,m,d)))))))))))))}if(c=p.join(""),b.shadowing){var r="<span",s="</span>";a.SHADOWING_STYLE&&(r+=' style="'+a.SHADOWING_STYLE+'"'),a.SHADOWING_CLASS&&(r+=' class="'+a.SHADOWING_CLASS+'"'),c=r+">"+c+s}return c},b}();